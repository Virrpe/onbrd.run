var s={};const a=typeof process<"u"&&(s==null?void 0:s.VITE_DEBUG_LOGS)==="true",l=(...t)=>{a&&console.log("[OA]",...t)},f=(...t)=>{a&&console.info("[OA]",...t)},g=(...t)=>{a&&console.warn("[OA]",...t)},p=(...t)=>{console.error("[OA]",...t)},c={log:l,info:f,warn:g,error:p};function h(t){const e=(r,i)=>{const o=new Date().toISOString();return`[${t}] ${r}: ${i} (${o})`};return{start:r=>{c.log(e("START",r))},ok:r=>{c.log(e("OK",r))},error:r=>{c.error(e("ERROR",r))}}}const n=h("BG"),m=300,w={version:"1.1.0",updatedAt:"2025-09-15T18:30:00Z",categories:["Foundation","Attention","Clarity","Trust","Action","Retention"],rules:[{id:"F-PERFORMANCE-LCP",category:"Foundation",weight:.0727,description:"Largest Contentful Paint should occur within ~2.5s.",fix:"Optimize hero media, lazy-load non-critical JS, compress images.",confidence:"medium"},{id:"F-ACCESSIBILITY-FOCUS",category:"Foundation",weight:.0545,description:"Interactive elements are keyboard accessible with visible focus.",fix:"Restore focus outlines; ensure Tab reaches all CTAs/inputs.",confidence:"high"},{id:"F-MOBILE-RESPONSIVE",category:"Foundation",weight:.0455,description:"Critical onboarding elements usable on mobile.",fix:"Add viewport meta; ensure hero CTA & form are usable <400px.",confidence:"high"},{id:"A-CTA-ABOVE-FOLD",category:"Attention",weight:.0909,description:"Primary CTA visible without scrolling (desktop & mobile).",fix:"Place primary signup CTA within initial viewport.",confidence:"high"},{id:"A-HEADLINE-VALUE-PROP",category:"Attention",weight:.0727,description:"Hero headline states value proposition clearly.",fix:"Lead with outcome-based headline, not features.",confidence:"medium"},{id:"A-VISUAL-HIERARCHY",category:"Attention",weight:.0545,description:"CTA has strongest visual weight in hero.",fix:"Increase size/contrast; directional cues to CTA.",confidence:"medium"},{id:"C-COGNITIVE-LOAD",category:"Clarity",weight:.0636,description:"Hero presents ≤5 distinct chunks (headline, subhead, 3 bullets).",fix:"Consolidate; use progressive disclosure.",confidence:"medium"},{id:"C-READABILITY-SCORE",category:"Clarity",weight:.0455,description:"Primary copy ≤ grade 8 reading level.",fix:"Shorten sentences; simpler vocabulary.",confidence:"low"},{id:"C-BENEFIT-CLARITY",category:"Clarity",weight:.0455,description:"Benefits are specific, outcome-focused.",fix:"Replace feature lists with concrete outcomes/time saved.",confidence:"medium"},{id:"T-SOCIAL-PROOF",category:"Trust",weight:.0818,description:"Credible social proof within signup viewport.",fix:"Add testimonials/logos/usage stats near CTA.",confidence:"high"},{id:"T-PRICING-TRANSPARENCY",category:"Trust",weight:.0545,description:"Pricing discoverable pre-signup.",fix:"Visible Pricing link in nav or near signup.",confidence:"high"},{id:"T-SECURITY-ASSURANCE",category:"Trust",weight:.0364,description:"Security/privacy reassurance near sensitive fields.",fix:"Add SSL/privacy text, policy links, or lock icon.",confidence:"low"},{id:"AC-SIGNUP-FRICTION",category:"Action",weight:.0727,description:"Initial account creation ≤3 fields.",fix:"Defer optional fields post-signup.",confidence:"high"},{id:"AC-PROGRESS-VISIBILITY",category:"Action",weight:.0455,description:"Multi-step flows show clear progress.",fix:"Add progress bar or 'Step X of Y'.",confidence:"high"},{id:"AC-ERROR-PREVENTION",category:"Action",weight:.0364,description:"Forms prevent common input errors.",fix:"Inline validation, input masks, helpful placeholders.",confidence:"medium"},{id:"R-TIME-TO-VALUE",category:"Retention",weight:.0727,description:"First core value reached in first session.",fix:"Quick-start, demo data, guided first task.",confidence:"medium"},{id:"R-EMPTY-STATE-DESIGN",category:"Retention",weight:.0273,description:"Avoid blank first-use screens.",fix:"Seed with sample content/next steps.",confidence:"low"},{id:"R-COMPLETION-FEEDBACK",category:"Retention",weight:.0273,description:"Positive reinforcement after first actions.",fix:"Success animation or confirmation with next action.",confidence:"medium"}]};chrome.runtime.onInstalled.addListener(()=>{n.ok("OnboardingAudit.ai extension installed")});async function A(){const t=new AbortController,e=setTimeout(()=>t.abort(),m);try{const r=`${self.API_BASE_URL||""}/api/v1/rules`,i=await fetch(r,{signal:t.signal});if(clearTimeout(e),!i.ok)throw new Error("rules http "+i.status);const o=await i.json();await chrome.storage.session.set({onbrd_rules:o})}catch{await chrome.storage.session.set({onbrd_rules:w})}}self.addEventListener("activate",t=>{t.waitUntil(A())});chrome.runtime.onMessage.addListener((t,e,r)=>(n.start(`Background script received message: ${JSON.stringify(t)}`),t.type==="RUN_AUDIT"?(y(r),!0):!1));async function y(t){try{n.start("Starting deterministic handshake...");const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.id)throw new Error("No active tab found");if(n.ok(`Active tab found: ${e.id}, ${e.url}`),await u(e.id),!await E(e.id))throw new Error("Content script not responding to PING after retry");const i=await I(e.id);n.ok(`Audit completed successfully: ${JSON.stringify(i)}`),t({success:!0,data:i})}catch(e){n.error(`Deterministic handshake failed: ${e instanceof Error?e.message:String(e)}`),t({success:!1,error:e instanceof Error?e.message:"Audit failed"})}}async function u(t){try{await chrome.scripting.executeScript({target:{tabId:t},files:["assets/content.js"]}),n.ok("Content script injected successfully")}catch(e){throw new Error(`Failed to inject content script: ${e instanceof Error?e.message:String(e)}`)}}async function E(t){if(await d(t))return!0;n.error("First PING attempt failed, retrying...");try{await u(t)}catch(i){return n.error(`Failed to re-inject content script: ${i instanceof Error?i.message:String(i)}`),!1}return await d(t)}async function d(t){try{const e=await Promise.race([chrome.tabs.sendMessage(t,{type:"PING"}),new Promise((r,i)=>setTimeout(()=>i(new Error("PING timeout")),1e3))]);return e&&typeof e=="object"&&"ok"in e&&e.ok===!0?(n.ok("PING successful - content script is responsive"),!0):(n.error(`PING response invalid: ${JSON.stringify(e)}`),!1)}catch(e){return e instanceof Error&&e.message==="PING timeout"?n.error("PING timeout - content script not responding within 1000ms"):n.error(`PING failed: ${e instanceof Error?e.message:String(e)}`),!1}}async function I(t){try{const e=await Promise.race([chrome.tabs.sendMessage(t,{type:"RUN_AUDIT"}),new Promise((r,i)=>setTimeout(()=>i(new Error("RUN_AUDIT timeout")),3e3))]);if(e&&typeof e=="object"&&"ok"in e&&e.ok===!0&&"data"in e)return n.ok("RUN_AUDIT successful - audit data received"),e.data;throw e&&typeof e=="object"&&"error"in e?new Error(`Content script error: ${e.error}`):new Error(`Invalid RUN_AUDIT response: ${JSON.stringify(e)}`)}catch(e){throw e instanceof Error&&e.message==="RUN_AUDIT timeout"?new Error("RUN_AUDIT timeout - content script not responding within 3000ms"):e}}
