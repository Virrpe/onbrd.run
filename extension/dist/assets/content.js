(function(){"use strict";var v;var _=typeof document<"u"?document.currentScript:null;const a={h_cta_above_fold:.25,h_steps_count:.2,h_copy_clarity:.2,h_trust_markers:.2,h_perceived_signup_speed:.15},d={h_cta_above_fold:"Move your primary CTA above the fold for immediate visibility",h_steps_count:"Reduce onboarding to 3 steps or fewer when possible",h_copy_clarity:"Use shorter sentences, active voice, and plain language",h_trust_markers:"Add testimonials, security badges, or customer logos",h_perceived_signup_speed:"Minimize required fields and show progress indicators"};function A(){const e=k(),t=E(e),o=T(e);return{id:L(),url:window.location.href,timestamp:new Date().toISOString(),heuristics:e,scores:t,recommendations:o}}function k(){return{h_cta_above_fold:C(),h_steps_count:I(),h_copy_clarity:O(),h_trust_markers:x(),h_perceived_signup_speed:M()}}function C(){const t=document.querySelectorAll('button, a, input[type="submit"], [class*="cta"], [class*="action"]');let o=!1,n=0,r="";const c=["start","begin","sign up","signup","get started","join","create","continue","next"];for(const s of t){const u=s.getBoundingClientRect(),f=(s.textContent||"").toLowerCase().trim(),y=c.some(b=>f.includes(b));if(u.top<600&&(y||s.className.toLowerCase().includes("cta"))){o=!0,n=Math.round(u.top),r=s.tagName.toLowerCase(),s.className&&(r+=`.${s.className.split(" ")[0]}`);break}}return{detected:o,position:n,element:r}}function I(){const e=document.querySelectorAll("form").length,t=document.querySelectorAll('[class*="step"], [class*="screen"], [class*="onboarding"], [class*="wizard"]').length,o=document.querySelectorAll('[class*="modal"], [role="dialog"]').length;return{total:Math.max(e,t,o,1),forms:e,screens:t}}function O(){const e=document.querySelectorAll("p, h1, h2, h3, h4, h5, h6, li, span, div");let t=0,o=0,n=0,r=0;const c=["utilize","leverage","synergy","paradigm","ecosystem","platform","solution","optimize","streamline","facilitate"];e.forEach(y=>{const S=(y.textContent||"").split(/[.!?]+/).filter(l=>l.trim().length>0);t+=S.length,S.forEach(l=>{const N=l.trim().split(/\s+/).length;o+=N,/\b(was|were|been|being|is|are|am)\s+\w+ed\b/i.test(l)&&n++;const U=l.toLowerCase();c.forEach(D=>{U.includes(D)&&r++})})});const s=t>0?Math.round(o/t):0,u=t>0?Math.round(n/t*100):0,f=o>0?Math.round(r/o*100):0;return{avg_sentence_length:s,passive_voice_ratio:u,jargon_density:f}}function x(){const e=document.querySelectorAll('[class*="testimonial"], [class*="review"], [class*="quote"], blockquote').length,t=document.querySelectorAll('[class*="security"], [class*="trust"], [class*="badge"], [class*="certified"], [alt*="security"], [alt*="ssl"]').length,o=document.querySelectorAll('[class*="logo"], [class*="customer"], [class*="client"], [alt*="logo"], img[src*="logo"]').length;return{testimonials:e,security_badges:t,customer_logos:o,total:e+t+o}}function M(){const e=document.querySelectorAll("input, select, textarea").length,t=document.querySelectorAll("[required]").length,o=document.querySelectorAll('[class*="progress"], [class*="step-indicator"]').length;let n=Math.max(e*5,t*10,30);return o>0&&(n=Math.round(n*.8)),{form_fields:e,required_fields:t,estimated_seconds:n}}function E(e){const t=e.h_cta_above_fold.detected?100:0;let o=100;e.h_steps_count.total>=8?o=40:e.h_steps_count.total>=6?o=60:e.h_steps_count.total>=4&&(o=80);let n=100;e.h_copy_clarity.avg_sentence_length>15&&(n-=Math.min(50,(e.h_copy_clarity.avg_sentence_length-15)*2)),e.h_copy_clarity.passive_voice_ratio>10&&(n-=Math.min(30,(e.h_copy_clarity.passive_voice_ratio-10)*3)),e.h_copy_clarity.jargon_density>5&&(n-=Math.min(20,(e.h_copy_clarity.jargon_density-5)*4)),n=Math.max(0,n);let r=40;e.h_trust_markers.total>=3?r=100:e.h_trust_markers.total===2?r=80:e.h_trust_markers.total===1&&(r=60);let c=40;e.h_perceived_signup_speed.estimated_seconds<30?c=100:e.h_perceived_signup_speed.estimated_seconds<60?c=80:e.h_perceived_signup_speed.estimated_seconds<120&&(c=60);const s=Math.round(t*a.h_cta_above_fold+o*a.h_steps_count+n*a.h_copy_clarity+r*a.h_trust_markers+c*a.h_perceived_signup_speed);return{h_cta_above_fold:t,h_steps_count:o,h_copy_clarity:n,h_trust_markers:r,h_perceived_signup_speed:c,overall:s}}function T(e){const t=[];return e.h_cta_above_fold.detected||t.push({heuristic:"h_cta_above_fold",priority:"high",description:"No clear call-to-action found above the fold (top 600px)",fix:d.h_cta_above_fold}),e.h_steps_count.total>3&&t.push({heuristic:"h_steps_count",priority:"medium",description:`Onboarding flow has ${e.h_steps_count.total} steps, which may cause friction`,fix:d.h_steps_count}),e.h_copy_clarity.avg_sentence_length>15&&t.push({heuristic:"h_copy_clarity",priority:"medium",description:`Average sentence length is ${e.h_copy_clarity.avg_sentence_length} words, which may reduce comprehension`,fix:d.h_copy_clarity}),e.h_copy_clarity.passive_voice_ratio>10&&t.push({heuristic:"h_copy_clarity",priority:"low",description:`${e.h_copy_clarity.passive_voice_ratio}% of sentences use passive voice, which can reduce clarity`,fix:"Use active voice to make sentences more direct and engaging"}),e.h_copy_clarity.jargon_density>5&&t.push({heuristic:"h_copy_clarity",priority:"low",description:`${e.h_copy_clarity.jargon_density}% of words are jargon, which may confuse users`,fix:"Replace technical terms with plain language"}),e.h_trust_markers.total<3&&t.push({heuristic:"h_trust_markers",priority:"medium",description:`Only ${e.h_trust_markers.total} trust signals detected, which may reduce user confidence`,fix:d.h_trust_markers}),e.h_perceived_signup_speed.estimated_seconds>60&&t.push({heuristic:"h_perceived_signup_speed",priority:"high",description:`Signup process appears to take ${e.h_perceived_signup_speed.estimated_seconds} seconds, which may cause abandonment`,fix:d.h_perceived_signup_speed}),t}function L(){return`audit-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const p={},h=typeof{url:_&&_.tagName.toUpperCase()==="SCRIPT"&&_.src||new URL("assets/content.js",document.baseURI).href}<"u"&&(p==null?void 0:p.VITE_DEBUG_LOGS)==="true"||typeof process<"u"&&((v=process.env)==null?void 0:v.VITE_DEBUG_LOGS)==="true",g={log:(...e)=>{h&&console.log("[OA]",...e)},info:(...e)=>{h&&console.info("[OA]",...e)},warn:(...e)=>{h&&console.warn("[OA]",...e)},error:(...e)=>{console.error("[OA]",...e)}};function $(e){const t=(o,n)=>{const r=new Date().toISOString();return`[${e}] ${o}: ${n} (${r})`};return{start:o=>{g.log(t("START",o))},ok:o=>{g.log(t("OK",o))},error:o=>{g.error(t("ERROR",o))}}}const i=$("CS");let m=null;const j=new MutationObserver(()=>{m&&clearTimeout(m),m=window.setTimeout(()=>{i.ok("SPA content change detected, ready for re-audit")},1e3)});function w(){j.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}),i.ok("OnboardingAudit.ai MutationObserver started for SPA support")}async function q(e=1500){return new Promise(t=>{let o,n=0;const r=window.fetch;window.fetch=async(...c)=>{n++,clearTimeout(o);try{const s=await r(...c);return n--,n===0&&(o=window.setTimeout(t,500)),s}catch(s){throw n--,n===0&&(o=window.setTimeout(t,500)),s}},o=window.setTimeout(()=>{window.fetch=r,t()},e)})}async function R(e){try{i.start("Starting audit with network idle detection..."),await q(1500),i.ok("Network idle detected or timeout reached, proceeding with audit");const o={...A(),metadata:{user_agent:navigator.userAgent,viewport:`${window.innerWidth}x${window.innerHeight}`,extension_version:"1.0.0",network_idle:!0,spa_support:!0}};e({ok:!0,data:o})}catch(t){i.error(`Audit failed: ${t instanceof Error?t.message:String(t)}`),e({ok:!1,error:t instanceof Error?t.message:"Unknown error"})}}window.__OA_READY__=!0,i.ok("READY"),window.__onboardingAuditInjected?i.ok("OnboardingAudit.ai content script already injected, skipping"):(window.__onboardingAuditInjected=!0,chrome.runtime.onMessage.addListener((e,t,o)=>(i.start(`Content script received message: ${JSON.stringify(e)}`),e.type==="PING"?(i.ok("PING received - content script is responsive"),o({ok:!0,ts:Date.now()}),!0):e.type==="RUN_AUDIT"?(R(o),!0):!1)),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{i.ok("OnboardingAudit.ai content script loaded via programmatic injection"),w()}):(i.ok("OnboardingAudit.ai content script loaded via programmatic injection"),w()),document.addEventListener("visibilitychange",()=>{document.hidden||i.ok("Page became visible, ready for audit")}))})();
