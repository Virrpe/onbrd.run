var fe=Object.defineProperty;var pe=(e,t,n)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var K=(e,t,n)=>pe(e,typeof t!="symbol"?t+"":t,n);import{p as $}from"./logger-mdW3G7Ld.js";function T(){}function ce(e){return e()}function ne(){return Object.create(null)}function H(e){e.forEach(ce)}function ae(e){return typeof e=="function"}function me(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function he(e){return Object.keys(e).length===0}function s(e,t){e.appendChild(t)}function D(e,t,n){e.insertBefore(t,n||null)}function B(e){e.parentNode&&e.parentNode.removeChild(e)}function w(e){return document.createElement(e)}function Q(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function O(e){return document.createTextNode(e)}function E(){return O(" ")}function V(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function u(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ge(e){return Array.from(e.childNodes)}function J(e,t){t=""+t,e.data!==t&&(e.data=t)}let P;function C(e){P=e}function be(){if(!P)throw new Error("Function called outside component initialization");return P}function _e(e){be().$$.on_mount.push(e)}const M=[],re=[];let N=[];const oe=[],we=Promise.resolve();let X=!1;function ye(){X||(X=!0,we.then(de))}function Y(e){N.push(e)}const W=new Set;let S=0;function de(){if(S!==0)return;const e=P;do{try{for(;S<M.length;){const t=M[S];S++,C(t),xe(t.$$)}}catch(t){throw M.length=0,S=0,t}for(C(null),M.length=0,S=0;re.length;)re.pop()();for(let t=0;t<N.length;t+=1){const n=N[t];W.has(n)||(W.add(n),n())}N.length=0}while(M.length);for(;oe.length;)oe.pop()();X=!1,W.clear(),C(e)}function xe(e){if(e.fragment!==null){e.update(),H(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Y)}}function ke(e){const t=[],n=[];N.forEach(r=>e.indexOf(r)===-1?t.push(r):n.push(r)),n.forEach(r=>r()),N=t}const ve=new Set;function Re(e,t){e&&e.i&&(ve.delete(e),e.i(t))}function Ee(e,t,n){const{fragment:r,after_update:l}=e.$$;r&&r.m(t,n),Y(()=>{const a=e.$$.on_mount.map(ce).filter(ae);e.$$.on_destroy?e.$$.on_destroy.push(...a):H(a),e.$$.on_mount=[]}),l.forEach(Y)}function Ae(e,t){const n=e.$$;n.fragment!==null&&(ke(n.after_update),H(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Le(e,t){e.$$.dirty[0]===-1&&(M.push(e),ye(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Oe(e,t,n,r,l,a,d=null,y=[-1]){const k=P;C(e);const o=e.$$={fragment:null,ctx:[],props:a,update:T,not_equal:l,bound:ne(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(k?k.$$.context:[])),callbacks:ne(),dirty:y,skip_bound:!1,root:t.target||k.$$.root};d&&d(o.root);let m=!1;if(o.ctx=n?n(e,t.props||{},(h,R,...A)=>{const c=A.length?A[0]:R;return o.ctx&&l(o.ctx[h],o.ctx[h]=c)&&(!o.skip_bound&&o.bound[h]&&o.bound[h](c),m&&Le(e,h)),R}):[],o.update(),m=!0,H(o.before_update),o.fragment=r?r(o.ctx):!1,t.target){if(t.hydrate){const h=ge(t.target);o.fragment&&o.fragment.l(h),h.forEach(B)}else o.fragment&&o.fragment.c();t.intro&&Re(e.$$.fragment),Ee(e,t.target,t.anchor),de()}C(k)}class Ue{constructor(){K(this,"$$");K(this,"$$set")}$destroy(){Ae(this,1),this.$destroy=T}$on(t,n){if(!ae(n))return T;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const l=r.indexOf(n);l!==-1&&r.splice(l,1)}}$set(t){this.$$set&&!he(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const $e="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($e);function le(e){let t,n,r;return{c(){t=Q("svg"),n=Q("circle"),r=Q("path"),u(n,"class","opacity-25"),u(n,"cx","12"),u(n,"cy","12"),u(n,"r","10"),u(n,"stroke","currentColor"),u(n,"stroke-width","4"),u(r,"class","opacity-75"),u(r,"fill","currentColor"),u(r,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),u(t,"class","animate-spin h-4 w-4 text-white"),u(t,"xmlns","http://www.w3.org/2000/svg"),u(t,"fill","none"),u(t,"viewBox","0 0 24 24")},m(l,a){D(l,t,a),s(t,n),s(t,r)},d(l){l&&B(t)}}}function se(e){let t,n,r;return{c(){t=w("button"),t.textContent="View Report",u(t,"class","w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors")},m(l,a){D(l,t,a),n||(r=V(t,"click",e[7]),n=!0)},p:T,d(l){l&&B(t),n=!1,r()}}}function ie(e){let t,n,r,l,a;return{c(){t=w("div"),n=w("div"),n.textContent="Error",r=E(),l=w("div"),a=O(e[2]),u(n,"class","text-sm text-red-800 font-medium mb-1"),u(l,"class","text-sm text-red-700"),u(t,"class","mt-4 p-3 bg-red-50 border border-red-200 rounded-md")},m(d,y){D(d,t,y),s(t,n),s(t,r),s(t,l),s(l,a)},p(d,y){y&4&&J(a,d[2])},d(d){d&&B(t)}}}function je(e){let t,n,r,l,a,d,y,k,o,m,h,R=e[1]?"Running audit...":"Run Audit",A,c,p,i,x,L,j,U,Z,I,ee,F,z,q,G,te,_=e[1]&&le(),g=e[4]&&se(e),b=e[2]&&ie(e);return{c(){t=w("main"),n=w("div"),r=w("h1"),r.textContent="Onbrd",l=E(),a=w("span"),d=O("v"),y=O(e[5]),k=E(),o=w("div"),m=w("button"),_&&_.c(),h=E(),A=O(R),c=E(),g&&g.c(),p=E(),i=w("button"),x=O("Export JSON"),j=E(),U=w("button"),Z=O("Export HTML"),ee=E(),b&&b.c(),F=E(),z=w("div"),q=O(e[0]),u(r,"class","text-xl font-bold text-gray-800"),u(a,"class","text-xs text-gray-600"),u(n,"class","flex justify-between items-center mb-4"),m.disabled=e[1],u(m,"class","w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"),i.disabled=L=!e[3],u(i,"class","w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"),U.disabled=I=!e[3],u(U,"class","w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"),u(o,"class","space-y-3"),u(z,"class","mt-4 text-sm text-gray-600"),u(t,"class","w-80 p-6 bg-white")},m(f,v){D(f,t,v),s(t,n),s(n,r),s(n,l),s(n,a),s(a,d),s(a,y),s(t,k),s(t,o),s(o,m),_&&_.m(m,null),s(m,h),s(m,A),s(o,c),g&&g.m(o,null),s(o,p),s(o,i),s(i,x),s(o,j),s(o,U),s(U,Z),s(t,ee),b&&b.m(t,null),s(t,F),s(t,z),s(z,q),G||(te=[V(m,"click",e[6]),V(i,"click",e[8]),V(U,"click",e[9])],G=!0)},p(f,[v]){v&32&&J(y,f[5]),f[1]?_||(_=le(),_.c(),_.m(m,h)):_&&(_.d(1),_=null),v&2&&R!==(R=f[1]?"Running audit...":"Run Audit")&&J(A,R),v&2&&(m.disabled=f[1]),f[4]?g?g.p(f,v):(g=se(f),g.c(),g.m(o,p)):g&&(g.d(1),g=null),v&8&&L!==(L=!f[3])&&(i.disabled=L),v&8&&I!==(I=!f[3])&&(U.disabled=I),f[2]?b?b.p(f,v):(b=ie(f),b.c(),b.m(t,F)):b&&(b.d(1),b=null),v&1&&J(q,f[0])},i:T,o:T,d(f){f&&B(t),_&&_.d(),g&&g.d(),b&&b.d(),G=!1,H(te)}}}const Se=5e3;function ue(e){return renderReport(e)}function Me(e,t,n){let r="Ready to audit",l=!1,a=null,d=null,y=!1,k="";_e(()=>{$.ok("Onbrd popup initialized");try{const c=chrome.runtime.getManifest();n(5,k=c.version)}catch(c){$.error("Failed to get version from manifest:",c),n(5,k="1.0.0")}});async function o(){n(2,a=null),n(1,l=!0),n(0,r="Running audit..."),$.start("Starting audit process");try{const c=new Promise((x,L)=>{setTimeout(()=>L(new Error("Audit timeout - please try refreshing the page and running again")),Se)}),p=chrome.runtime.sendMessage({type:"RUN_AUDIT"}),i=await Promise.race([p,c]);if(i!=null&&i.success&&(i!=null&&i.data))$.ok("Audit completed successfully"),m(i.data);else{const x=(i==null?void 0:i.error)||"Audit failed";throw $.error(`Audit failed: ${x}`),new Error(x)}}catch(c){const p=c.message||"Unknown error occurred";$.error(`Audit error: ${p}`),p.includes("timeout")?n(2,a="Audit timed out. Please refresh the page and try again."):p.includes("Extension context invalidated")?n(2,a="Extension needs to be reloaded. Please refresh the page and try again."):n(2,a=`Audit failed: ${p}. Please refresh the page and try again.`),n(0,r="Ready to audit"),n(1,l=!1)}}function m(c){$.ok(`Audit result received: ${JSON.stringify(c)}`),n(3,d=c),n(0,r=`Audit complete! Score: ${c.scores.overall}/100`),n(1,l=!1),n(4,y=!0)}function h(){if(!d)return;const c=ue(d),p=new Blob([c],{type:"text/html"}),i=URL.createObjectURL(p);chrome.tabs.create({url:i})}function R(){if(!d){n(0,r="No audit data to export");return}const c=JSON.stringify(d,null,2),p=new Blob([c],{type:"application/json"}),i=URL.createObjectURL(p),x=document.createElement("a");x.href=i,x.download=`onboarding-audit-${d.id}.json`,x.click(),URL.revokeObjectURL(i),n(0,r="Audit exported successfully")}function A(){if(!d){n(0,r="No audit data to export");return}try{const c=ue(d),p=new Blob([c],{type:"text/html"}),i=URL.createObjectURL(p),x=new URL(d.url).hostname.replace(/\./g,"-"),L=new Date(d.timestamp).toISOString().split("T")[0].replace(/-/g,""),j=document.createElement("a");j.href=i,j.download=`onboarding-audit-${x}-${L}.html`,j.click(),URL.revokeObjectURL(i),n(0,r="HTML report exported successfully")}catch(c){n(0,r=`Error exporting HTML: ${c.message}`)}}return[r,l,a,d,y,k,o,h,R,A]}class Ne extends Ue{constructor(t){super(),Oe(this,t,Me,je,me,{})}}const Pe=new Ne({target:document.body});export{Pe as default};
