# OnboardingAudit.ai System Dependency Diagram

## Current Architecture (with Duplication Issues)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Frontend Layer                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Extension (MV3)                    â”‚  Site (Static)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ popup/App.svelteâ”‚               â”‚  â”‚ index.html      â”‚                  â”‚
â”‚  â”‚ content/entry.tsâ”‚               â”‚  â”‚ styles.css      â”‚                  â”‚
â”‚  â”‚ shared/inject.tsâ”‚               â”‚  â”‚ tokens.css      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                                                  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â”‚                    Core Logic Layer (DUPLICATION ISSUE)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ packages/core   â”‚  â”‚ packages/core   â”‚  â”‚ packages/report â”‚            â”‚
â”‚  â”‚ src/probes.ts   â”‚  â”‚ src/scoring.ts  â”‚  â”‚ src/index.ts    â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ âŒ CONTAINS:    â”‚  â”‚ âœ… CONTAINS:    â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ detectCTA()   â”‚  â”‚ â€¢ calculateScores() â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ countSteps()  â”‚  â”‚ â€¢ generateIssues()  â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ analyzeCopy() â”‚  â”‚ â€¢ generateRecommendations() â”‚     â”‚            â”‚
â”‚  â”‚ â€¢ findTrust()   â”‚  â”‚ â€¢ getScoreColor()   â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ estimateSpeed()â”‚ â”‚ â€¢ getScoreLabel()   â”‚             â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ âŒ ALSO CONTAINS:â”‚ â”‚ âœ… CONSTANTS:   â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ calculateScores() â”‚ â€¢ HEURISTIC_WEIGHTS â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ generateRecommendations() â”‚ â€¢ HEURISTIC_FIXES â”‚       â”‚            â”‚
â”‚  â”‚ â€¢ HEURISTIC_WEIGHTS â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ HEURISTIC_FIXES â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â”‚                    â”‚                    â”‚   Backend API Layer   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ POST /api/v1/   â”‚  â”‚ GET /api/v1/   â”‚  â”‚ GET /api/      â”‚              â”‚
â”‚  â”‚ ingest          â”‚  â”‚ rules          â”‚  â”‚ healthz        â”‚              â”‚
â”‚  â”‚                 â”‚  â”‚                â”‚  â”‚                â”‚              â”‚
â”‚  â”‚ â€¢ Validation    â”‚  â”‚ â€¢ Rule manifestâ”‚  â”‚ â€¢ Health check â”‚              â”‚
â”‚  â”‚ â€¢ Rate limiting â”‚  â”‚ â€¢ Scoring configâ”‚ â”‚ â€¢ Timestamp    â”‚              â”‚
â”‚  â”‚ â€¢ PostgreSQL    â”‚  â”‚ â€¢ ETag caching â”‚  â”‚                â”‚              â”‚
â”‚  â”‚ â€¢ Benchmarks    â”‚  â”‚ â€¢ Validation   â”‚  â”‚                â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## Duplication Issues Identified

1. **HEURISTIC_WEIGHTS** - Defined in both `probes.ts` and `scoring.ts`
2. **HEURISTIC_FIXES** - Defined in both `probes.ts` and `scoring.ts`
3. **calculateScores()** - Implemented in both `probes.ts` and `scoring.ts`
4. **generateRecommendations()** - Implemented in both `probes.ts` and `scoring.ts`

## Proposed Refactored Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Frontend Layer                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Extension (MV3)                    â”‚  Site (Static)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ popup/App.svelteâ”‚               â”‚  â”‚ index.html      â”‚                  â”‚
â”‚  â”‚ content/entry.tsâ”‚               â”‚  â”‚ styles.css      â”‚                  â”‚
â”‚  â”‚ shared/inject.tsâ”‚               â”‚  â”‚ tokens.css      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                                                  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â”‚                    Core Logic Layer (REFACTORED)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ packages/core   â”‚  â”‚ packages/core   â”‚  â”‚ packages/report â”‚            â”‚
â”‚  â”‚ src/probes.ts   â”‚  â”‚ src/scoring.ts  â”‚  â”‚ src/index.ts    â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  âœ… CONTAINS:      â”‚  âœ… CONTAINS:      â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ detectCTA()   â”‚  â”‚ â€¢ calculateScores() â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ countSteps()  â”‚  â”‚ â€¢ generateIssues()  â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ analyzeCopy() â”‚  â”‚ â€¢ generateRecommendations() â”‚     â”‚            â”‚
â”‚  â”‚ â€¢ findTrust()   â”‚  â”‚ â€¢ getScoreColor()   â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ estimateSpeed()â”‚ â”‚ â€¢ getScoreLabel()   â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ performAudit()â”‚  â”‚ â€¢ CONSTANTS:        â”‚             â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚   - HEURISTIC_WEIGHTS â”‚           â”‚            â”‚
â”‚  â”‚ âŒ REMOVED:     â”‚  â”‚   - HEURISTIC_FIXES â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ calculateScores() â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ generateRecommendations() â”‚         â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ HEURISTIC_WEIGHTS â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ â€¢ HEURISTIC_FIXES â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â”‚                    â”‚                    â”‚   Backend API Layer   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ POST /api/v1/   â”‚  â”‚ GET /api/v1/   â”‚  â”‚ GET /api/      â”‚              â”‚
â”‚  â”‚ ingest          â”‚  â”‚ rules          â”‚  â”‚ healthz        â”‚              â”‚
â”‚  â”‚                 â”‚  â”‚                â”‚  â”‚                â”‚              â”‚
â”‚  â”‚ â€¢ Validation    â”‚  â”‚ â€¢ Rule manifestâ”‚  â”‚ â€¢ Health check â”‚              â”‚
â”‚  â”‚ â€¢ Rate limiting â”‚  â”‚ â€¢ Scoring configâ”‚ â”‚ â€¢ Timestamp    â”‚              â”‚
â”‚  â”‚ â€¢ PostgreSQL    â”‚  â”‚ â€¢ ETag caching â”‚  â”‚                â”‚              â”‚
â”‚  â”‚ â€¢ Benchmarks    â”‚  â”‚ â€¢ Validation   â”‚  â”‚                â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                             â”‚
â”‚  ğŸ†• ENTERPRISE API STUBS:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ POST /api/v1/auth/signup     â”‚ GET /api/v1/org/teams               â”‚    â”‚
â”‚  â”‚ POST /api/v1/auth/login      â”‚ POST /api/v1/org/teams              â”‚    â”‚
â”‚  â”‚ POST /api/v1/auth/logout     â”‚ GET /api/v1/rules/custom            â”‚    â”‚
â”‚  â”‚ GET  /api/v1/auth/session    â”‚ POST /api/v1/rules/custom           â”‚    â”‚
â”‚  â”‚ POST /api/v1/billing/webhook â”‚ GET /api/v1/analytics/cohort        â”‚    â”‚
â”‚  â”‚ GET /api/v1/billing/subscriptionâ”‚ GET /api/v1/analytics/retention  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## Key Changes

1. **Single Responsibility**: `probes.ts` handles detection only, `scoring.ts` handles scoring logic
2. **Constants Consolidation**: All constants moved to `scoring.ts`
3. **Import Updates**: All consumers import from `scoring.ts` for scoring functions
4. **Enterprise APIs**: New stub endpoints for auth, billing, org, rules/custom, analytics
5. **Test Coverage**: Added unit tests with 80% coverage threshold
6. **CI/CD Updates**: Enhanced workflows with coverage reporting